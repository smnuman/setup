#!/bin/bash -e

[ -z "$DEBUG" ] || set -x

main() {
  os_x_software_update
  update_package_sources
  upgrade_installed_packages
  upgrade_installed_casks
  # shellcheck disable=SC1091
  . libconfig/homebrew_htop
  # update go pkgs
  update_vim_plugins
  cleanup
}

os_x_software_update() {
  softwareupdate --install --all
}

update_package_sources() {
  brew update
}

upgrade_installed_packages() {
  brew upgrade --all
}

upgrade_installed_casks() {
  local cask

  brew cask list | while read -r cask
  do
    brew cask install "$cask"
  done
}

update_vim_plugins() {
  vim +PluginUpdate +PluginClean! +qall
}

cleanup() {
  brew cleanup -s --force
  brew cask cleanup
}

main
